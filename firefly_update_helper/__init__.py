import httpx
from loguru import logger

VERSION = "0.1"
class UpdateHelper:
    def __init__(self,working_mode:str="github"
                ,gh_repo:str="user/repo"
                ,current_subchannel:dict={}
                ,current_channel:str="default"
                ,metadata_url:str=None
                ,firefly:bool=False):
        """
        初始化更新助手

        params:
        - working_mode str 从何处拉取元数据/安装包
            - github 从GitHub仓库拉取
            - server 从FireflyUpdateHelper服务器拉取（没做）

        - gh_repo str 从GitHub拉取时，拉取的目标仓库（格式：user/repo，例如LHGS_github/FireflyUpdateHelper）

        - current_subchannel dict 当前子频道，具体内容取决于清单文件

        - current_channel str 当前频道，具体内容取决于清单文件

        - metadata_url str 元数据的直链位置，设置此参数后会从该位置拉取清单文件，仅对GitHub模式生效

        - firefly bool 设为True时打印一张字符画，生产环境不建议开启
        """
        self.working_mode = working_mode
        self.gh_repo = gh_repo
        self.current_subchannel = current_subchannel
        self.current_channel = current_channel
        logger.info(f"Firefly Update Helper Version {VERSION}")
        logger.info(f"工作模式：{self.working_mode}，当前频道：{self.current_channel}，当前子频道：{self.current_subchannel}")
        logger.info("正在拉取元数据...")
        if self.working_mode == "github":
            if metadata_url:
                self.get_metadata(metadata_url)
        if firefly:
            print("""
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%@@@@%#**+++++++++***##%%@@@@@@@@@@@@@@@@@@@@@@@@@%
    @@@@%**++*##%@@@@@@@@@@@@@@@@@@@%##*+++++++++***+++++--+*##%%%%%%%###***++==%@@@@@@@@@@@@@@@@@@@@@@%
    @@@*-####=+*+++++*#%@@@@@@@%#*+++**#%%%@@@@@@@@@@@@@%%%#%@@@@@@@@@@@@@@@@@@#:*@@@@@@@@@@@@@@@@@@@@@%
    @@%.%@%@@%+#@@@%##*++*#%#+++*#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%@%.%@@@@@@@@@@@@@@@@@@@@%
    @@+=@%%%#**=%@@@@@@@%*==*#@@@@@@@@@@@@@@@@@%####%@@@@@@@@@@@@@@@@@@@@@@@@@@%@==@@@@@@@@@@@@@@@@@@@@%
    @@-+@#***@@#+@@@@@@#+#%@@@@@@@@@@@@@@@@@@@@%%%%#***#@@@@@@@@@@@@@@@@@@@%%@@%@#:@@@@@@@@@@@@@@@@@@@@%
    @@-***@@@@@@=#@@@@@%%@@@@@@@%%%@@@@@@%%#*++======-::=*%@@@@@@@@@@@@@@@@@@@@%@#:@@@@@@@@@@@@@@@@@@@@%
    @@=+#+@@@@%@*+@%%@@@@@@@@@%**#%%#*+=-------==========--+#@@@@@@@@@@@@@%#%@@%@*-@@@@@%*+++=@@@@@@@@@%
    @@+=#+@@@%%%%=**%@@@@@@@@#+**+==-:--====================-+#@@%@@@@@@@@@%**%@@-*@@@*++*#%@:*@@@@@@@@%
    @@%.=@@@%%%@#=#@@@@@@@@@=:=++#%*===============----------::-#@@@@@@@@@@@@%++*-@@*=+#%@@%%-*@@@@@@@@%
    @@@:=*@@%%@*+%@%@@@@@@%-.-+%@@%+======--------==+++********=+*%@@@@@@@@@@@@*:=@==%@%@%%%%.%@@@@@@@@%
    @@@+-+@@%@++@@%@@@@@@@=-==-*@@@%*-:--=+*##%%@@@@@@@@@@@@@@@@@#+#@@@@@@@@@@@@@*.-@@@%%%@@+=@@@@@@@@@%
    @@@%.+#@@+*@@@@@@@@@@+-===+##++=+*#%@@@@@@@@@@@@@%*%@@@@@@@%%@%+#@@@@@@@@@@@@@%+=@@@@@#+.++++**@@@@%
    @@@@-+#*+*@@@@@@@@@@#-==-:-=+#%@@@@@@@@@@@@@@@@@@@%=%@@@@@@@@%@@%@@@@@@@@@@@@%@@*-#@==++######:+@@@%
    @@@@%:@*+@@@@@@@@@@@=-::=*%@@@@*%@@@@@@@@@@@@@@@@%@*+@%@@@@@@@@@@@@@@@@@@@@@@@@%@%-.*%@@@%@@@%:%@@@%
    @@@@@*:=%@@@@@@@@@@#.-*%@@@@@@@=#@@@@@@@@@@@@@@@@@@@=#@@@@@@@@@@@@@@@@@@@@@@@@@@%@@=-@@@%%@@#:*@@@@%
    @@@@@@:*@%@@@@@@@@@+*@@@@@@@@@@+#@@@@@@@@@@@@@@@@@@@#-*%@@@@@@@@@@@#*@@@@@@@@@@@@@@@+-@@@@%+-#@@@@@%
    @@@@@#:@@@@@@@@@@@%=@@@@@@@@@@@=*@%@@@@@@@@@@@@@@@@@%+%**#%@@@@@@@@@+*@%@@@@@@@@@@@%@=-*=-:=@@@@@@@%
    @@@@@=+@%@@@@@@@@@#=@@@@@@@@@@#=+@@@@@@@@@@@@@%%@@@@@=@@@#**#%@@@@@@%=%@@@@@@@@@@@@@@@:.-----=%@@@@%
    @@@@@.#@@@@@@@@@@@#+@%@@@@@@@@=@+#@@@@@@@@@@@@@+#@@@@+#@@@@@%#*##%%%@++@@@@@@@@@@@@%#@#.-==== =@@@@%
    @@@@@.%@@@@@@@@@@@%%@@@@@@@@@+#@%=@@@@@@@@@@@@@@+%@%@*#@@@@@@@@@%####*=%@@@@@@@@@@@%=+@::===:=@@@@@%
    @@@@==@%@@@@@@@@@@@@@@@@@@@@+#@@@#+@@@@@@@@@@@@@%+%@@*#@@@@@@@@@@@@@@@+#@@@@@@@%@@@@@::+:==:-@@@@@@%
    @@@%:%@@@@@@@@@@@@%#@@@@@@%+%@@@@@#+%@@@@@@@@@@@@%+#@+#@@@@@@@@@@@@@@@#+@@@@@%%%%@@%@# ..-::%@@@@@@%
    @@@+-@%@@@@@@@@@@@%=%@@@@*+@@@@@@@@%+#%@%+##%%@@@@@+*=@@*=--=+**#%@@@@%+@%%%@%%%%%%%%@:  -=-@@@@@@@%
    @@@-+@%@@@@@@@@@@@@+#@@#+#@@@@@@@@@@@#**#=#%###*****=#@@.          .:*%+@%%%#%%%%%%%%@: :.+*-@@@@@@%
    @@@-*@%@@%@@@@@@@@@#+#**@@@@@@@@@@@@@@@@%#%@@@@@@@@@@@@@@%*+=-:..    :=#@%%++%%%%%@#%%..:-.-==@@@@@%
    @@@-*@@@:*@%@@@@@@@@=+@@@@@@@@@@@@%+-:.*@@@@@@@@@@%+*@@@@@@@@@@@@%%##+=#***=+@%%%@% +=.: -=::.+@@@@%
    @@@-+@@- %@@@@@@@@@@%=@@@@@@@@@@+:    .#@@@#*#=-====%@@@@@@@@@@@@@@@@#%%%@@++@%%@#-=-=.-: -==:.#@@@%
    @@@*-@+ =@@@@@@@@@%%@**@@@@@@%=.    -#@@@@@%**#@@@@@@@@@@@@@@@@@@@@@@@@@@@@+%%%#*=:@@@.-=. :-=- +@@%
    @@@@:#::#@@@%@@%%%%%%@+#@@@@=    .=%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+=#**#%#:*@@--==.-=-+-+@@%
    @@@@%: *@@#*@%%%%%%%%%%+*@@#   -*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:.%%@@@+*:@@#.==-.+@@%:@@%
    @@@@@-=@%@@-#@%%%%%%%%%@#+*#*+%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%@@@@@@@@@@@% *@@@@@=@=+@@*-:==*@%@-*@%
    @@@+:*@%%*+=-#@%%*+*###*##+%%%@@@@@@@@@@@@@@@@@@@@@@@@%=::---:::=#@@@@@@@-.@@@@@%=%@:%@@@-@@@%%@*-@%
    @@@*+++++*#@%-+%@%%#=*%*:%@@@@@@@@@@@@@@@@@@@@@@@@@@@= -#@@@@@@#=.:#@@%%* +@%@@@%=%@*:@@@-%%%%%%#:@%
    @@@@@@@@@@@@@@+-=##%#=#@#-=@@@@@@@@#+=----+#@@@@@@@@* *@@@@%@%#@@@= +%###=.%@@@@%=%@@+-@@:#%%%%%%:@@
    @@@@@@@@@@@@@@@*:*+##**%@%.#%@@@#--=+****+=..#@@@@@@- @@%*@#@@%@@@@* +%##%-:@@@@%=%@@@=-%:%%%%#%%:@@
    @@@@@@@@@@@@@@@*-%=@@@@%@#:###%-.#@@@@@@@@@@- *@@@@@.:@@@@@#***@@@@@= ##### *@@@@+%@@@@+ :@%@+.%#-@%
    @@@@@@@@@@@@@@@==@+#@%%%@*.##%-.%@@@@@@@@@@@@: @@@@@: @@@@%##%@@@@@@@=####%=.@@@@**@@@@#-#%#-+=+-#@%
    @@@@@@@@@@@@@@@.#@#+@%%%@--%##-@%-+*%@@@@@@@@% +@@@@%-%@@@@@@@@@@@@@@@#####* *@@@@%@%*+-**:.#@::#@@%
    @@@@@@@@@@@@@@-=@%%=%%%@#.####%@@@#++====++=*@.+@@@@@@@@@@@@@@@@@@@@@%#####%.:@@@@@@%####%%+=#@@@@@%
    @@@@@@@@@@@@@=-@%%%=%%%@:=%###%@@@@@@@@%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@%#####%= %@@@@@@@@@@@@@#-+@@@@%
    @@@@@@@@@@@@--%%%%%=#%@=:%####@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%######* *@%%%%%%%%%%%%@@-=@@@%
    @@@@@@@@@@*-+@%%%%%#%%*.#####%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%####### +@@@@@@@@@@@@@%%@-+@@@
    %%%%%%%%#-:*#*********.=*****#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#******* =################*.%%#
    """)

    def get_metadata(self,metadata_url:str=None):
        resp = httpx.get(metadata_url)
        resp.encoding = resp.charset_encoding
        logger.debug(resp)